! Адаптировано из тестов самого Inform 6 (исходники Inform 7)
-cases		[Main] 'rinform/Tests/Test Cases'

-recipe [Main]
	set: $I6 = /usr/bin/inform
	! set: $WORKSPACE = Workspace
	set: $INT = /home/alexander/bin/dglulxe
  set: $INTNAME		= dglulxe
  set: $INTOPTIONS	= -u -q
	set: $TOC = NO
	! On the basis of which:
  set: $EXT           = ulx
  set: $I6OPTIONS		= -G -Cu +language_name=Russian +rinform/library --opt DICT_CHAR_SIZE=4 --define MAX_UNICODE_CHARS=1024 --opt MAX_STATIC_DATA=30000
  show: $PATH

	mkdir: $PATH/_Story_File_Actual
	set: $I6SOURCE = $PATH/$CASE.inf
	set: $STORYFILE = $PATH/_Story_File_Actual/$CASE.$EXT

	mkdir: $PATH/_Transcript_Actual
	mkdir: $PATH/_md5_Actual

	set: $AMD5 = $PATH/_md5_Actual/$CASE.txt
	set: $IMD5 = $PATH/_md5_Ideal/$CASE.txt
	set: $A = $PATH/_Transcript_Actual/$CASE.txt
	set: $I = $PATH/_Transcript_Ideal/$CASE.txt

	! debugger: lldb -f $I6 -- `$I6OPTIONS $I6SOURCE $STORYFILE
	step: $I6 `$I6OPTIONS $I6SOURCE $STORYFILE 2>&1

  step: echo ${glulx:$STORYFILE$} >$AMD5
	if exists: $IMD5
		match text: $AMD5 $IMD5
		or: 'compiled, but produced the wrong md5 checksum'
		
		pass: 'passed, no need to run because md5 correct'
	endif

  set: $SCRIPT = $PATH/_Scripts/$CASE.txt
  if exists: $SCRIPT
    step: $INT `$INTOPTIONS $STORYFILE <$SCRIPT >$A 2>&1
    or: 'compiled, but was unable to run $INTNAME (do you need to make interpreters?)'
  else
    step: $INT `$INTOPTIONS $STORYFILE >$A 2>&1
    or: 'compiled, but was unable to run $INTNAME (do you need to make interpreters?)'
  endif

  exists: $I
  or: 'compiled, but no ideal transcript existed'
  match glulxe transcript: $A $I
  or: 'compiled, but played incorrectly'

  pass: 'passed'
-end
